<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home Routines</title>
<style>
body { font-family: sans-serif; margin: 20px; }
h1, h2 { margin-top: 20px; }
.task-row { display: flex; align-items: center; margin-bottom: 10px; padding: 5px; border-radius: 5px; }
.task-row label { margin-left: 8px; flex: 1; cursor: pointer; }
.task-note { margin-left: 10px; flex: 2; }
.completed { background-color: #d0f0c0; }
.current-zone { background-color: #ffff99; } /* kiemelt aktuális zóna */
button { margin: 5px; padding: 5px 10px; }
</style>
</head>
<body>

<h1>Home Routines</h1>

<h2>Napi rutin</h2>
<div id="daily-tasks"></div>

<h2>Heti rutin</h2>
<div id="weekly-tasks"></div>

<h2>Zónák</h2>
<div id="zones"></div>

<h2>Megoldandó feladatok</h2>
<div>
  <input type="text" id="todo-input" placeholder="Feladat felírása">
  <button id="add-todo">Hozzáad</button>
  <ul id="todo-list"></ul>
</div>

<h2>Időzítők</h2>
<button onclick="startTimer(2)">2 perc</button>
<button onclick="startTimer(5)">5 perc</button>
<button onclick="startTimer(15)">15 perc</button>
<div id="timer-display"></div>

<script>
// --- JSON adat ---
let data = JSON.parse(localStorage.getItem("home-routines-data")||"null") || {
  daily:{morning:["Fogmosás","Mosogató rendbetétele"], day:["1 Hot Spot"], evening:["Ruhák előkészítése"]},
  weekly:["Heti tervezés","Hűtő átnézése"],
  zones:[
    {name:"Zóna 1 – Előszoba + nappali", tasks:[{t:"Padló felmosása", last:null, note:""}]},
    {name:"Zóna 2 – Étkező", tasks:[{t:"Függöny mosása", last:null, note:""}]},
    {name:"Zóna 3", tasks:[]},
    {name:"Zóna 4", tasks:[]},
    {name:"Zóna 5", tasks:[]}
  ],
  todo:[]
};

// --- Lista generálása ---
function createTaskRow(text, parent, note="", zoneNumber=null) {
  const div = document.createElement('div');
  div.className = 'task-row';
  if(zoneNumber) div.dataset.zoneNumber = zoneNumber;

  const cb = document.createElement('input');
  cb.type = 'checkbox';
  const label = document.createElement('label');
  label.textContent = text;

  // iOS fix: érintésre is pipálható
  cb.addEventListener('touchstart', e=>{cb.checked=!cb.checked;e.preventDefault();});
  label.addEventListener('click',()=>cb.checked=!cb.checked);

  div.appendChild(cb);
  div.appendChild(label);

  const inputNote = document.createElement('input');
  inputNote.type = 'text';
  inputNote.className = 'task-note';
  inputNote.value = note;
  div.appendChild(inputNote);

  parent.appendChild(div);
}

// Napi rutin
const dailyDiv = document.getElementById('daily-tasks');
["morning","day","evening"].forEach(part=>{
  data.daily[part].forEach(task=>createTaskRow(task,dailyDiv));
});

// Heti rutin
const weeklyDiv = document.getElementById('weekly-tasks');
data.weekly.forEach(task=>createTaskRow(task,weeklyDiv));

// Zónák
const zonesDiv = document.getElementById('zones');
data.zones.forEach((z,i)=>{
  z.tasks.forEach(taskObj=>{
    createTaskRow(taskObj.t, zonesDiv, taskObj.note, i+1);
  });
});

// --- Aktuális zóna kiemelés ---
function highlightCurrentZone() {
  const zones = document.querySelectorAll('#zones .task-row');
  const today = new Date();
  const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  // Hétfővel kezdődik a hét
  let weekNumber = Math.ceil((today.getDate() + firstDayOfMonth.getDay() - 1)/7);
  // 5 zóna rotáció
  const currentZoneNumber = ((weekNumber - 1) % 5) + 1;
  zones.forEach(z => {
    if(parseInt(z.dataset.zoneNumber) === currentZoneNumber){
      z.classList.add('current-zone');
    } else {
      z.classList.remove('current-zone');
    }
  });
}
highlightCurrentZone();

// --- Todo lista ---
const todoInput = document.getElementById('todo-input');
const todoList = document.getElementById('todo-list');
document.getElementById('add-todo').addEventListener('click', ()=>{
  if(todoInput.value.trim()==="") return;
  const li = document.createElement('li');
  li.textContent = todoInput.value;
  todoList.appendChild(li);
  todoInput.value="";
});

// --- Időzítő ---
let timerInterval;
function startTimer(minutes){
  clearInterval(timerInterval);
  let seconds = minutes*60;
  const display = document.getElementById('timer-display');
  display.textContent=`${minutes}:00`;
  timerInterval = setInterval(()=>{
    const m=Math.floor(seconds/60);
    const s=seconds%60;
    display.textContent = `${m}:${s<10?"0":""}${s}`;
    if(seconds<=0){clearInterval(timerInterval); alert("Időzítő lejárt!");}
    seconds--;
  },1000);
}

// --- Adatok mentése a localStorage-be ---
window.addEventListener('beforeunload', ()=>{
  localStorage.setItem("home-routines-data", JSON.stringify(data));
});
</script>

</body>
</html>
